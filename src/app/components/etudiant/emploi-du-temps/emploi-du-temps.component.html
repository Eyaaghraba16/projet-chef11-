<div class="emploi-container">
  <h2>üìÖ Gestion des Emplois du Temps</h2>

  <div *ngIf="message" class="message">{{ message }}</div>

  <form (ngSubmit)="ajouterEmploi()">
    <div class="form-row">
      <div class="form-group">
        <label>D√©partement *</label>
        <select [(ngModel)]="selectedDepartementId" name="departement" (change)="onDepartementChange()" required>
          <option [value]="null">S√©lectionner un d√©partement</option>
          <option *ngFor="let d of departements" [value]="d.id">{{ d.nom }}</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Sp√©cialit√© (optionnel - sauf pour 1√®re ann√©e)</label>
        <select [(ngModel)]="selectedSpecialiteId" name="specialite" (change)="onSpecialiteChange()" [disabled]="!selectedDepartementId">
          <option [value]="null">Aucune (1√®re ann√©e - Tranc commun)</option>
          <option *ngFor="let s of specialites" [value]="s.id">{{ s.nom }}</option>
        </select>
        <small *ngIf="!selectedDepartementId" style="color: #666;">S√©lectionnez d'abord un d√©partement</small>
      </div>
      
      <div class="form-group">
        <label>Groupe *</label>
        <select [(ngModel)]="newEmploi.id_groupe" name="id_groupe" required [disabled]="!selectedDepartementId">
          <option [value]="null">S√©lectionner un groupe *</option>
          <option *ngFor="let g of groupes" [value]="g.id">{{ g.nom }} {{ g.niveau ? '(' + g.niveau + ')' : '' }}</option>
        </select>
        <small *ngIf="!selectedDepartementId" style="color: #666;">S√©lectionnez d'abord un d√©partement</small>
        <small *ngIf="selectedDepartementId && groupes.length === 0" style="color: #666;">Aucun groupe disponible</small>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Mati√®re *</label>
        <select [(ngModel)]="newEmploi.id_matiere" name="id_matiere" required>
          <option [value]="null">S√©lectionner une mati√®re *</option>
          <option *ngFor="let m of matieres" [value]="m.id">{{ m.nom }} ({{ m.code }})</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Enseignant *</label>
        <select [(ngModel)]="newEmploi.id_enseignant" name="id_enseignant" required>
          <option [value]="null">S√©lectionner un enseignant *</option>
          <option *ngFor="let e of enseignants" [value]="e.id">{{ e.nom }} {{ e.prenom }}</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Salle *</label>
        <select [(ngModel)]="newEmploi.id_salle" name="id_salle" required>
          <option [value]="null">S√©lectionner une salle *</option>
          <option *ngFor="let s of salles" [value]="s.id">{{ s.nom }}</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Date *</label>
        <input type="date" [(ngModel)]="newEmploi.date" name="date" required />
      </div>
      
      <div class="form-group">
        <label>Heure d√©but *</label>
        <input type="time" [(ngModel)]="newEmploi.heure_debut" name="heure_debut" required />
      </div>
      
      <div class="form-group">
        <label>Heure fin *</label>
        <input type="time" [(ngModel)]="newEmploi.heure_fin" name="heure_fin" required />
      </div>
      
      <div class="form-group">
        <label>Type de s√©ance</label>
        <select [(ngModel)]="newEmploi.type_seance" name="type_seance">
          <option value="cours">Cours</option>
          <option value="td">TD</option>
          <option value="tp">TP</option>
          <option value="examen">Examen</option>
        </select>
      </div>
      
      <div class="form-group">
        <button type="submit" class="btn-primary">‚ûï Ajouter</button>
      </div>
    </div>
  </form>

  <table *ngIf="emplois.length > 0; else vide">
    <thead>
      <tr>
        <th>Date</th>
        <th>Heure</th>
        <th>Mati√®re</th>
        <th>Enseignant</th>
        <th>Salle</th>
        <th>Groupe</th>
        <th>Type</th>
        <th>Statut</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let e of emplois">
        <td>{{ e.date | date:'shortDate' }}</td>
        <td>{{ e.heure_debut }} - {{ e.heure_fin }}</td>
        <td>{{ e.matiere }} ({{ e.matiere_code }})</td>
        <td>{{ e.enseignant }}</td>
        <td>{{ e.salle }}</td>
        <td>{{ e.groupe }}</td>
        <td>{{ e.type_seance }}</td>
        <td>{{ e.statut }}</td>
        <td>
          <button (click)="supprimerEmploi(e.id)">üóëÔ∏è Supprimer</button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #vide>
    <p>Aucun emploi du temps trouv√©.</p>
  </ng-template>
</div>
